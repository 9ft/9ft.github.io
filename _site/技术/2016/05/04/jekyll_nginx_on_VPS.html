<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <title>VPS 上利用 Jekyll Nginx 搭建博客</title> <meta name="description" content="以前买的虚拟空间虽然很稳定, 但自己能控制的东西不多. 折腾VPS, 把个人博客迁移过去. 换个胃口, 先不折腾 LEMP 了, 装个 Jekyll 好啦."> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/assets/icon/style.css"> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://yourdomain.com/%E6%8A%80%E6%9C%AF/2016/05/04/jekyll_nginx_on_VPS.html"> <link rel="alternate" type="application/rss+xml" title="Tech Log" href="http://yourdomain.com/feed.xml" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:mindycong@gmail.com" class="sidebar-social-icon email"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="技术">技术</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/05/30/vs-error-remote-local.html"> VS 错误: 本地调试时出现远程调试器错误 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/05/06/HEXO.html"> HEXO </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/05/05/LNMP_on_Ubuntu.html"> Ubuntu 下安装 LNMP </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/05/04/jekyll_nginx_on_VPS.html"> VPS 上利用 Jekyll Nginx 搭建博客 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/11/30/LAMP_Tomcat_FTP.html"> Ubuntu 的 LAMP Tomcat FTP 安装和配置 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/24/whow-to-run-cuda.html"> 运行第一个 Cuda 程序 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/22/x-window-fix.html"> Linux 不能进入 x window </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/18/git-win-ssh.html"> Windows 下使用 Git 的配置 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/17/sublime-config.html"> Sublime 配置 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/14/ubuntu-installation.html"> Ubuntu 配置 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/12/build-v.html"> v_p_n 架设 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/12/build-ss.html"> SS搭建 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2006/12/31/Hello-World.html"> First Post </a> </nav> </div> </aside> <main id="main"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2016 May 04</span> </div> <h1 class="post-title">VPS 上利用 Jekyll Nginx 搭建博客</h1> <p>以前买的虚拟空间虽然很稳定, 但自己能控制的东西不多. 折腾VPS, 把个人博客迁移过去. 换个胃口, 先不折腾 <code class="highlighter-rouge">LEMP</code> 了, 装个 <code class="highlighter-rouge">Jekyll</code> 好啦.</p> <h1 id="ruby">安装 <code class="highlighter-rouge">Ruby</code></h1> <p>使用 <code class="highlighter-rouge">RVM</code> 安装, 参照 <a href="https://rvm.io/rvm/install">Installing RVM</a></p> <blockquote> <p>Before any other step install mpapis public key (might need gpg2) (see security) <code class="highlighter-rouge">shell gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 </code></p> </blockquote> <blockquote> <p>Install RVM (development version):</p> </blockquote> <div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="se">\c</span>url -sSL https://get.rvm.io | bash
</code></pre></div> <blockquote> <p>Display a list of all known rubies.</p> </blockquote> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>rvm list known
</code></pre></div> <blockquote> <p>Install a version of Ruby (eg 2.2)</p> </blockquote> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>rvm install 2.2
</code></pre></div> <blockquote> <p>Check this worked correctly</p> </blockquote> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>ruby -v
</code></pre></div> <h1 id="jekyll">安装 <code class="highlighter-rouge">Jekyll</code></h1> <p>参照 <a href="https://jekyllrb.com/">Jekyll Quick-start Instructions</a>.</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>gem install jekyll
jekyll new my-awesome-site
<span class="nb">cd </span>my-awesome-site
</code></pre></div> <h1 id="jekyll-">部署 <code class="highlighter-rouge">Jekyll</code> 生成的网站</h1> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>jekyll build --source ~/my-awesome-site --destination /var/www/awesomeblog
</code></pre></div> <h1 id="nginx">配置 <code class="highlighter-rouge">Nginx</code></h1> <p>复制默认配置文件</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/example.com
</code></pre></div> <p>参照 <a href="https://www.digitalocean.com/community/tutorials/how-to-get-started-with-jekyll-on-an-ubuntu-vps">How To Get Started with Jekyll on an Ubuntu VPS</a> 在 <code class="highlighter-rouge">example.com</code> 中写一个最简单的配置文件:</p> <div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="n">server</span> {
  <span class="n">listen</span> <span class="m">80</span>;
  <span class="c"># the domain of your VPS
</span>  <span class="n">server_name</span> <span class="n">example</span>.<span class="n">com</span>;
  <span class="n">root</span> /<span class="n">home</span>/<span class="n">deployer</span>/<span class="n">blog</span>/<span class="n">current</span>;
  <span class="n">index</span> <span class="n">index</span>.<span class="n">html</span>
  <span class="n">expires</span> <span class="m">1</span><span class="n">d</span>;
}
</code></pre></div> <p>Using symlinks means it’s easy to take a site offline by removing the symlink without touching the original configuration file.</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/example.com
</code></pre></div> <p>Tests the nginx configuration.</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo nginx -t
</code></pre></div> <p>Restart nginx.</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo service nginx restart
</code></pre></div> <h1 id="http--git-">架设 <code class="highlighter-rouge">HTTP</code> 协议的 <code class="highlighter-rouge">Git</code> 服务器</h1> <h2 id="section">安装</h2> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo apt-get install git gitweb fcgiwrap
</code></pre></div> <h2 id="section-1">配置</h2> <h3 id="nginx--fastcgi">配置 <code class="highlighter-rouge">Nginx</code> 可运行 <code class="highlighter-rouge">fastcgi</code></h3> <p>参照 <a href="http://beginor.github.io/2016/03/12/http-git-server-on-nginx.html">在 Ubuntu 系统上配置 Nginx Git 服务器</a> 和 <a href="http://weininger.net/configuration-of-nginx-for-gitweb-and-git-http-backend.html">NGINX Configuration for Gitweb and git-http-backend</a> 中的配置.</p> <div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="c"># HTTP server
</span><span class="n">server</span> {
  <span class="n">listen</span> <span class="m">80</span>;
  <span class="n">listen</span> [::]:<span class="m">80</span>;
  <span class="n">server_name</span> <span class="n">git</span>.<span class="n">mindy</span>.<span class="n">tk</span>;
  <span class="n">root</span> /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">gitweb</span>;
  <span class="n">access_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>/<span class="n">git</span>.<span class="n">mindy</span>.<span class="n">tk</span>.<span class="n">access</span>.<span class="n">log</span>;
  <span class="n">error_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>/<span class="n">git</span>.<span class="n">mindy</span>.<span class="n">tk</span>.<span class="n">error</span>.<span class="n">log</span>;

  <span class="c">#ssl                  on;
</span>  <span class="c">#ssl_certificate      /etc/ssl/certs/certforyoursite.crt;
</span>  <span class="c">#ssl_certificate_key  /etc/ssl/private/sitekey.pem;
</span>  <span class="c">#ssl_session_timeout 5m;
</span>  <span class="c">#ssl_protocols        TLSv1 TLSv1.1 TLSv1.2;
</span>  <span class="c">#ssl_ciphers          HIGH:!ADH:!MD5;
</span>  <span class="c">#ssl_prefer_server_ciphers on;
</span>
  <span class="c"># static repo files for cloning over https
</span>  <span class="n">location</span> ~ ^.*\.<span class="n">git</span>/<span class="n">objects</span>/([<span class="m">0</span>-<span class="m">9</span><span class="n">a</span>-<span class="n">f</span>]+/[<span class="m">0</span>-<span class="m">9</span><span class="n">a</span>-<span class="n">f</span>]+|<span class="n">pack</span>/<span class="n">pack</span>-[<span class="m">0</span>-<span class="m">9</span><span class="n">a</span>-<span class="n">f</span>]+.(<span class="n">pack</span>|<span class="n">idx</span>))$ {
    <span class="n">auth_basic</span> <span class="s2">"Restricted"</span>;
    <span class="n">auth_basic_user_file</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">passwd</span>;

    <span class="n">root</span> /<span class="n">var</span>/<span class="n">www</span>/<span class="n">git</span>.<span class="n">mindy</span>.<span class="n">tk</span>;
  }

  <span class="c"># requests that need to go to git-http-backend
</span>  <span class="n">location</span> ~ ^.*\.<span class="n">git</span>/(<span class="n">HEAD</span>|<span class="n">info</span>/<span class="n">refs</span>|<span class="n">objects</span>/<span class="n">info</span>/.*|<span class="n">git</span>-(<span class="n">upload</span>|<span class="n">receive</span>)-<span class="n">pack</span>)$ {
    <span class="n">auth_basic</span> <span class="s2">"Restricted"</span>;
    <span class="n">auth_basic_user_file</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">passwd</span>;

    <span class="n">root</span> /<span class="n">var</span>/<span class="n">www</span>/<span class="n">git</span>.<span class="n">mindy</span>.<span class="n">tk</span>;

    <span class="n">fastcgi_pass</span> <span class="n">unix</span>:/<span class="n">var</span>/<span class="n">run</span>/<span class="n">fcgiwrap</span>.<span class="n">socket</span>;
    <span class="n">fastcgi_param</span> <span class="n">SCRIPT_FILENAME</span>   /<span class="n">usr</span>/<span class="n">lib</span>/<span class="n">git</span>-<span class="n">core</span>/<span class="n">git</span>-<span class="n">http</span>-<span class="n">backend</span>;
    <span class="n">fastcgi_param</span> <span class="n">PATH_INFO</span>         $<span class="n">uri</span>;
    <span class="n">fastcgi_param</span> <span class="n">GIT_PROJECT_ROOT</span>  /<span class="n">var</span>/<span class="n">www</span>/<span class="n">git</span>.<span class="n">mindy</span>.<span class="n">tk</span>;
    <span class="n">fastcgi_param</span> <span class="n">GIT_HTTP_EXPORT_ALL</span> <span class="s2">""</span>;
    <span class="n">fastcgi_param</span> <span class="n">REMOTE_USER</span> $<span class="n">remote_user</span>;
    <span class="n">include</span> <span class="n">fastcgi_params</span>;
  }

  <span class="c"># send anything else to gitweb if it's not a real file
</span>  <span class="n">try_files</span> $<span class="n">uri</span> @<span class="n">gitweb</span>;
  <span class="n">location</span> @<span class="n">gitweb</span> {
    <span class="n">root</span> /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">gitweb</span>;
    <span class="n">auth_basic</span> <span class="s2">"Restricted"</span>;
    <span class="n">auth_basic_user_file</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">passwd</span>;

    <span class="n">fastcgi_pass</span> <span class="n">unix</span>:/<span class="n">var</span>/<span class="n">run</span>/<span class="n">fcgiwrap</span>.<span class="n">socket</span>;
    <span class="n">fastcgi_param</span> <span class="n">SCRIPT_FILENAME</span>   /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">gitweb</span>/<span class="n">gitweb</span>.<span class="n">cgi</span>;
    <span class="n">fastcgi_param</span> <span class="n">PATH_INFO</span>         $<span class="n">uri</span>;
    <span class="n">fastcgi_param</span> <span class="n">GITWEB_CONFIG</span>     /<span class="n">etc</span>/<span class="n">gitweb</span>.<span class="n">conf</span>;
    <span class="n">include</span> <span class="n">fastcgi_params</span>;
 }
}
</code></pre></div> <h3 id="gitwebconf">配置 <code class="highlighter-rouge">gitweb.conf</code></h3> <p>修改 <code class="highlighter-rouge">/etc/gitweb.conf</code> 为:</p> <div class="language-conf highlighter-rouge"><pre class="highlight"><code>$<span class="n">projectroot</span> = <span class="s2">"/usr/share/nginx/git.mindy.tk"</span>
</code></pre></div> <h3 id="htpasswd-">使用 <code class="highlighter-rouge">htpasswd</code> 创建用户</h3> <p>使用 <code class="highlighter-rouge">htpasswd</code> 创建用户名及其密码.</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>htpasswd /etc/nginx/passwd user1
</code></pre></div> <h1 id="section-2">建立与本地仓库的连接</h1> <h2 id="section-3">服务器上建立裸仓库</h2> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>git init --bare test.git
</code></pre></div> <p>注意检查一下 <code class="highlighter-rouge">test.git</code> 的权限, 如果权限不足的话, 使用命令设置一下权限:</p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>chmod a+rw -R test.git
</code></pre></div> <h2 id="hook">设置<code class="highlighter-rouge">Hook</code></h2> <p>参照 <a href="https://www.digitalocean.com/community/tutorials/how-to-deploy-jekyll-blogs-with-git">How To Deploy Jekyll Blogs with Git</a> <a href="http://jekyllrb.com/docs/deployment-methods/">Deployment methods</a></p> <div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">cd </span>hooks
vi post-receive
</code></pre></div> <p>加入:</p> <div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash -l
</span><span class="n">GIT_REPO</span>=$<span class="n">HOME</span>/<span class="n">repos</span>/<span class="n">awesomeblog</span>.<span class="n">git</span>
<span class="n">TMP_GIT_CLONE</span>=$<span class="n">HOME</span>/<span class="n">tmp</span>/<span class="n">git</span>/<span class="n">awesomeblog</span>
<span class="n">PUBLIC_WWW</span>=/<span class="n">var</span>/<span class="n">www</span>/<span class="n">awesomeblog</span>

<span class="n">git</span> <span class="n">clone</span> $<span class="n">GIT_REPO</span> $<span class="n">TMP_GIT_CLONE</span>
<span class="n">jekyll</span> <span class="n">build</span> --<span class="n">source</span> $<span class="n">TMP_GIT_CLONE</span> --<span class="n">destination</span> $<span class="n">PUBLIC_WWW</span>
<span class="n">rm</span> -<span class="n">Rf</span> $<span class="n">TMP_GIT_CLONE</span>
<span class="n">exit</span>
</code></pre></div> <div class="language-shell highlighter-rouge"><pre class="highlight"><code>chmod +x post-receive
</code></pre></div> <h1 id="enjoy">Enjoy</h1> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://yourdomain.com/%E6%8A%80%E6%9C%AF/2016/05/04/jekyll_nginx_on_VPS.html&text=VPS 上利用 Jekyll Nginx 搭建博客" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://yourdomain.com/%E6%8A%80%E6%9C%AF/2016/05/04/jekyll_nginx_on_VPS.html&title=VPS 上利用 Jekyll Nginx 搭建博客" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://yourdomain.com/%E6%8A%80%E6%9C%AF/2016/05/04/jekyll_nginx_on_VPS.html&title=VPS 上利用 Jekyll Nginx 搭建博客" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="comment container"> <div id="disqus_thread"> <a href=""></a> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">©2016 <span class="icon-heart3"></span> Mindy</p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-46567212-3', 'auto'); ga('send', 'pageview'); </script> </body> </html>
